<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.org/schema/seam/taglib"
                xmlns:a="http://richfaces.org/a4j" xmlns:r="http://richfaces.org/rich"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:h="http://java.sun.com/jsf/html">

    <f:subview >
    <ui:decorate template="/layout/system/PersonInput.xhtml">

        <ui:param name="label" value="#{mainLabel}"/>
        <ui:param name="personEntityHelper" value="#{businessPersonComponent.personInstance}"/>
        <ui:param name="personStatus" value="#{businessPersonComponent.personInstance.uuid}_person"/>



        <s:decorate id="businessPersonPhoneField" styleClass="form-group" template="/layout/edit.xhtml">
            <ui:define name="label">
                #{messages.Tel}
            </ui:define>
            <ui:param name="for" value="bussinessPersionPhoneInput"/>
            <h:inputText label="#{messages.Tel}" size="30" maxlength="15"
                         styleClass="form-control" validatorMessage="#{messages.requiredPhoneValidator}"
                         value="#{businessPersonComponent.personInstance.personEntity.phone}" required="#{runParam.getBooleanParamValue('applyPersonTelMust')}"
                         id="bussinessPersionPhoneInput">
                <f:validateRegex
                        pattern="\+?(\d{2})?((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)"/>
                <r:validator event="blur"/>
            </h:inputText>

        </s:decorate>
    </ui:decorate>

    <c:if test="#{(empty canHaveProxyPerson) ? false : canHaveProxyPerson}">
        <f:subview id="#{businessPersonComponent.personInstance.uuid}_person_proxy">
        <s:decorate
                id="proxyPersonTypeField" styleClass="form-group" template="/layout/edit.xhtml">

            <ui:param name="for" value="proxyPersonTypeInput"/>
            <ui:param name="showLabel" value="false"/>
            <h:selectOneMenu value="#{businessPersonComponent.proxyType}" id="proxyPersonTypeInput"
                             styleClass="selectpicker select-menu-btn">

                <s:selectItems value="#{proxyTypes}" var="_proxyType" noSelectionLabel="无代理人"
                               label="#{messages[_proxyType.name()]}" itemValue="#{_proxyType}"/>
                <a:ajax render="proxyPersonPanel" event="valueChange" execute="@this"
                        oncomplete="bindclick();initDynamicEditInputs('#{r:clientId('proxyPersonPanel')}');">
                    <a:attachQueue requestDelay="0"/>
                </a:ajax>
                <s:convertEnum/>

            </h:selectOneMenu>
        </s:decorate>

            <a:outputPanel id="proxyPersonPanel">
                <a:outputPanel rendered="#{not empty businessPersonComponent.proxyType}">



                    <ui:decorate template="/layout/system/PersonInput.xhtml">
                        <ui:param name="personEntityHelper" value="#{businessPersonComponent.proxyPersonHelper}"/>
                        <ui:param name="showMainLabel" value="false"/>
                        <ui:param name="allowCredentialsTypeList" value="#{personCredentialsTypes}"/>
                        <ui:param name="personStatus" value="#{businessPersonComponent.personInstance.uuid}_proxy_person"/>


                        <s:decorate id="businessProxyPersonPhoneField" styleClass="form-group" template="/layout/edit.xhtml">
                            <ui:define name="label">
                                #{messages.Tel}
                            </ui:define>
                            <ui:param name="for" value="proxyPersonPhoneInput"/>
                            <h:inputText label="#{messages.Tel}" size="30" maxlength="15"
                                         styleClass="form-control" validatorMessage="#{messages.requiredPhoneValidator}"
                                         value="#{businessPersonComponent.proxyPersonHelper.personEntity.phone}" required="#{runParam.getBooleanParamValue('applyPersonTelMust')}"
                                         id="proxyPersonPhoneInput">
                                <f:validateRegex
                                        pattern="\+?(\d{2})?((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)"/>
                                <r:validator event="blur"/>
                            </h:inputText>

                        </s:decorate>
                    </ui:decorate>


                </a:outputPanel>

            </a:outputPanel>


        </f:subview>
    </c:if>


    </f:subview>

</ui:composition>