<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:a="http://richfaces.org/a4j"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:s="http://jboss.org/schema/seam/taglib">
<f:view
        contentType="text/html">

<h:head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <!-- meta http-equiv="X-UA-Compatible" content="IE=8"/-->
    <title>#{messages.mainTitle}</title>
    <link rel="shortcut icon" href="#{request.contextPath}/favicon.ico"/>
    <h:outputStylesheet name="theme.ecss"/>
    <h:outputStylesheet name="theme.css"/>
    <ui:insert name="head"/>
</h:head>
<h:body>

<a:queue requestDelay="0" ignoreDupResponses="true"/>

<rich:toolbar height="30">
    <rich:toolbarGroup>
        <a:commandLink value="updateFile" onclick="#{rich:component('updateFilePopup')}.show(); return false;"/>
    </rich:toolbarGroup>

    <rich:toolbarGroup>
        <h:form>
            <h:selectOneMenu value="#{buildGridMapHome.orderGenerate}">
                <s:selectItems value="#{houseOrderGenerates}" var="_generateType" label="#{messages[_generateType.name()]}" />
                <s:convertEnum/>
            </h:selectOneMenu>

            <a:commandLink action="#{buildGridMapHome.generateHouse}" value="generate"
                           render="grid_map,idle" execute="@form"/>
        </h:form>
    </rich:toolbarGroup>

    <rich:toolbarGroup>
        <a:commandLink value="idle house" onclick="#{rich:component('idleHousePopup')}.show(); return false;"/>
    </rich:toolbarGroup>

    <rich:toolbarGroup location="right">
        <a:status>
            <f:facet name="start">
                <h:graphicImage value="/img/connect.gif"/>
            </f:facet>
            <f:facet name="stop">
                <h:graphicImage value="/img/connect_idle.gif"/>
            </f:facet>
        </a:status>
        <h:outputText value="XXX build name"/>
    </rich:toolbarGroup>
</rich:toolbar>


<rich:popupPanel id="updateFilePopup" modal="true" autosized="true" resizeable="false">
    <f:facet name="header">
        <h:outputText value="plase upload file"/>
    </f:facet>
    <f:facet name="controls">
        <a:commandButton immediate="true" execute="@this" image="/img/close.png"
                         onclick="#{rich:component('updateFilePopup')}.hide();return false;"/>
    </f:facet>


    <h:form enctype="multipart/form-data">
        <rich:fileUpload maxFilesQuantity="5" title="#{messages.deployJpdlPar}"
                         serverErrorLabel="#{messages.fileUpload_serverErrorLabel}"
                         deleteLabel="#{messages.fileUpload_deleteLabel}"
                         doneLabel="#{messages.fileUpload_doneLabel}"
                         cancelEntryControlLabel="#{messages.fileUpload_cancelEntryControlLabel}"
                         addLabel="#{messages.fileUpload_addControlLabel}"
                         progressLabel="#{messages.fileUpload_progressLabel}"
                         sizeExceededLabel="#{messages.fileUpload_sizeErrorLabel}"
                         uploadLabel="#{messages.fileUpload_uploadControlLabel}"
                         transferErrorLabel="#{messages.fileUpload_transferErrorLabel}"
                         clearAllLabel="#{messages.fileUpload_clearAllControlLabel}"
                         clearLabel="#{messages.fileUpload_clearControlLabel}"
                         stopControlLabel="#{messages.fileUpload_stopControlLabel}"
                         fileUploadListener="#{buildGridMapHome.templeteFileUploadListener}"
                         ontyperejected="alert('#{messages.unsupportedProcessDefFile}');"
                         acceptedTypes="xml">

            <a:ajax event="uploadcomplete"
                    oncomplete="#{rich:component('updateFilePopup')}.hide();#{rich:component('idleHousePopup')}.show();"
                    execute="@none"
                    render="grid_map,idle"/>
        </rich:fileUpload>
    </h:form>
</rich:popupPanel>


<h:outputStylesheet>
    #buildGridMap td, #buildGridMap th {
        font-size: 1em;
        border: 1px solid #{richSkin.panelBorderColor};
        padding: 0px 0px 0px 0px;

    }

    .panelc {
        width: 25%;
    }

    .footerClass {
        text-align: center;
        padding-top: 5px;
    }

    .rf-ind-drag {
        font-size: 11px;
        cursor: pointer;
        width: 100%;
        height: 100%;
        border: 0px solid gray;
        padding: 0px
    }

    .rf-idle-drag {
        font-size: 11px;
        cursor: pointer;
        width: 52px;
        height: 25px;
        border: 1px solid #{richSkin.panelBorderColor};
        padding: 0px
    }

    .indicator-drag {
        border: 1px solid #000000;
        background-color: gray;
        opacity: 0.3;
        margin: 2px;
        height: 60px;
        width: 60px;
        text-align: center;
    }

    .indicator-acpt {
        height: 40px;
        width: 40px;
        border: 1px dotted red;
        background-color: green;
    }

    .indicator-rejt {
        height: 40px;
        width: 40px;
        border: 1px dotted green;
        background-color: red;
    }

    .rf-p-b {
        width: 100%;
        height: 100%;
        padding: 0px;
    }

    .new-house-panel {
        width: 60px;
        height: 60px;
        background: url('#{facesContext.externalContext.requestContextPath}/img/house/house.png') center center no-repeat;
    }

.idle-house-panel {
    min-height: 60px;
}

</h:outputStylesheet>

<h:form>
    <a:jsFunction name="gridDbClick">

    </a:jsFunction>
</h:form>

<rich:popupPanel>

</rich:popupPanel>


<a:status id="processWaiting" name="processWaiting"
          onstart="#{rich:component('wait')}.show()"
          onstop="#{rich:component('wait')}.hide()"/>
<rich:popupPanel id="wait" modal="true" autosized="true"
                 moveable="false" resizeable="false">
    <h:panelGrid columns="3">
        <h:graphicImage value="/img/smalBlueWait.gif"/>
        &#160;
        <h:outputText value="#{messages.wait_please}..."/>
    </h:panelGrid>
</rich:popupPanel>

<h:form>

    <rich:dragIndicator id="indicator" acceptClass="indicator-acpt" draggingClass="indicator-drag"
                        rejectClass="indicator-rejt"/>

    <!-- oncontextmenu="window.event.returnValue = false" -->
    <a:outputPanel id="grid_map">
        <table oncontextmenu="window.event.returnValue = false" style="width:#{buildGridMapHome.colList.size * 62}px; border: 0px solid #98bf21;padding: 0px 0px 0px 0px;border-collapse: collapse;border-spacing:1px"
               id="buildGridMap">

            <a:repeat value="#{buildGridMapHome.colList}" var="_col">
                <col style="width:60px;height: 60px;"></col>
            </a:repeat>

            <tbody>
            <tr>
                <a:repeat value="#{buildGridMapHome.instance.houseGridTitleList}" var="_unit">
                    <th colspan="#{_unit.colspan}" rowspan="1" style="height: 40px;">
                        #{_unit.title}
                    </th>
                </a:repeat>
            </tr>
            <a:repeat value="#{buildGridMapHome.instance.gridRowList}" var="_floor">
                <tr style="height: 60px">

                    <th style="height: 60px">
                        #{_floor.title}
                    </th>

                    <a:repeat value="#{_floor.gridBlockList}" var="_house">
                        <td colspan="#{_house.colspan}"
                            rowspan="#{_house.rowspan}" style="height: #{_house.rowspan * 60}px;">
                            <rich:panel
                                    style="width:100%; height: 100%;padding:0px;border: 0px;">
                                <rich:dropTarget id="grid_target" acceptedTypes="house block newHouse"
                                                 dropValue="#{_house}"
                                                 execute="@this"
                                                 status="processWaiting"
                                                 dropListener="#{buildGridMapHome.processDrop}"
                                                 render="grid_map,idle"/>

                                <a:outputPanel layout="block" styleClass="rf-ind-drag"
                                               rendered="#{not empty _house.house}">
                                    <rich:dragSource id="grid_source" type="block" dragIndicator="indicator"
                                                     dragValue="#{_house}"/>
                                    <rich:inplaceInput editEvent="dblclick" value="#{_house.house.houseOrder}" defaultLabel="new" >
                                        <a:ajax execute="@this" event="blur"/>
                                    </rich:inplaceInput>
                                    <rich:contextMenu mode="client" showEvent="contextmenu">
                                        <rich:menuItem action="#{buildGridMapHome.idleHouse}" label="idle"
                                                       status="processWaiting"
                                                       mode="ajax" execute="@this" render="grid_map,idle">
                                            <a:param name="blockId" value="#{_house.id}"
                                                     assignTo="#{buildGridMapHome.selectBlockId}"/>
                                        </rich:menuItem>
                                        <rich:menuItem action="#{buildGridMapHome.deleteHouse}" label="delete"
                                                      status="processWaiting" mode="ajax" execute="@this" render="grid_map">
                                            <a:param name="blockId" value="#{_house.id}"
                                                     assignTo="#{buildGridMapHome.selectBlockId}"/>
                                        </rich:menuItem>
                                        <rich:menuItem label="edit" mode="client" execute="@this" render="">

                                        </rich:menuItem>


                                    </rich:contextMenu>

                                </a:outputPanel>


                            </rich:panel>
                        </td>
                    </a:repeat>
                </tr>
            </a:repeat>
            </tbody>
        </table>
    </a:outputPanel>


    <rich:popupPanel id="idleHousePopup" resizeable="false" autosized="true" modal="false">
        <f:facet name="header">
            <h:outputText value="idle house"/>
        </f:facet>
        <f:facet name="controls">
            <a:commandButton immediate="true" execute="@this" image="/img/close.png"
                             onclick="#{rich:component('idleHousePopup')}.hide();return false;"/>
        </f:facet>
        <rich:panel styleClass="new-house-panel">
            <a:outputPanel layout="block" styleClass="rf-ind-drag">
                <rich:dragSource type="newHouse" dragValue="newHouse" dragIndicator="indicator"/>
            </a:outputPanel>
        </rich:panel>
        <rich:panel styleClass="idle-house-panel">
            <h:dataTable id="idle" value="#{buildGridMapHome.idleHouses}" var="_idleHouse">
                <h:column>
                    <a:outputPanel layout="block" styleClass="rf-idle-drag">
                        <rich:dragSource id="idle_source" type="house" dragValue="#{_idleHouse}"
                                         dragIndicator="indicator"/>
                        <h:outputText value="#{_idleHouse.houseOrder}"/>
                    </a:outputPanel>
                </h:column>
            </h:dataTable>
        </rich:panel>
    </rich:popupPanel>
</h:form>


</h:body>

</f:view>
</html>