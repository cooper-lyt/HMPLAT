<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.org/schema/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:dh="http://www.dgsoft.com/jsf/html"
                xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:a="http://richfaces.org/a4j" xmlns:r="http://richfaces.org/rich"
                template="/layout/template-data.xhtml">



    <ui:param name="funcName" value="#{messages.BusinessDefingConfig}"/>

    <ui:decorate template="/layout/edit-modalpanel.xhtml">
        <ui:param name="panelId" value="editPanel"/>
        <ui:param name="panelTitle" value="#{messages.businessDefine}"/>

        <ui:define name="actionButtons">
        <button type="button" class="button default" data-dismiss="modal">
            <span class="glyphicon glyphicon-floppy-remove"/>
            #{messages.abort}</button>

            <a:commandLink styleClass="button submit primary" render="editPanel_inputs,dataNav,dataResult"
                           rendered="#{not businessDefineHome.managed}" execute="@form"
                           oncomplete="if (#{facesContext.maximumSeverity==null} || #{facesContext.maximumSeverity.ordinal lt 2}){$('#editPanel').modal('hide')}"
                           action="#{businessDefineHome.persist}">

                <span class="glyphicon glyphicon-floppy-disk"/>
                #{messages.saveCreate}
            </a:commandLink>
            <a:commandLink styleClass="button submit primary" render="editPanel_inputs,dataNav,dataResult"
                           execute="@form" rendered="#{businessDefineHome.managed}"
                           oncomplete="if (#{facesContext.maximumSeverity==null} || #{facesContext.maximumSeverity.ordinal lt 2}){$('#editPanel').modal('hide')}"
                           action="#{businessDefineHome.update}">

                <span class="glyphicon glyphicon-floppy-disk"/>
                #{messages.saveUpdate}
            </a:commandLink>

        </ui:define>

        <div class="form-inline">
            <s:decorate id="idField" styleClass="form-group " template="/layout/edit-big.xhtml">
                <ui:define name="label">
                    #{messages.businessDefine_field_id}
                </ui:define>
                <ui:param name="for" value="idInput"/>
                <ui:param name="status" value="idStatus"/>
                <h:inputText
                        label="#{messages.businessDefine_field_id}"
                        name="#{messages.businessDefine_field_id}"
                        disabled="#{businessDefineHome.managed}"
                        required="true"
                        size="20"
                        maxlength="32"
                        valueChangeListener="#{businessDefineHome.verifyIdAvailable}"
                        value="#{businessDefineHome.instance.id}"
                        id="idInput"  styleClass="form-control" >
                    <f:validateRequired/>
                    <a:ajax event="change" render="idField" status="idStatus"/>
                </h:inputText>

            </s:decorate>


            <div class="form-big-switch form-group">
                <dh:switch value="#{businessDefineHome.instance.enable}"
                           rendered="#{businessDefineHome.managed}"
                           onText="#{messages.Enable}"
                           offText="#{messages.Disable}"
                           styleClass="js-switch "/>

            </div>

        </div>


        <s:decorate id="wfnameField" styleClass="form-group " template="/layout/edit-big.xhtml">
            <ui:define name="label">#{messages.businessDefine_field_wfname}</ui:define>
            <ui:param name="for" value="wfName"/>
            <h:selectOneMenu id="wfName" value="#{businessDefineHome.instance.wfName}"
                      styleClass="selectpicker edit-select form-control"
                      label="#{messages.businessDefine_field_wfname}" required="true">
                <s:selectItems value="#{jpdlNameList}" var="_jpdlName" label="#{_jpdlName}"
                               noSelectionLabel="#{messages.noSelectLabel}"/>
                <r:validator event="change"/>
            </h:selectOneMenu >

        </s:decorate>

        <s:decorate id="categoryField"  styleClass="form-group " template="/layout/edit-big.xhtml">
            <ui:define name="label">#{messages.businessDefine_category}</ui:define>
            <ui:param name="for" value="category"/>
            <h:selectOneMenu id="category" styleClass="selectpicker edit-select form-control"
                      value="#{businessDefineHome.instance.businessCategory}"
                      label="#{messages.businessDefine_category}" required="true">
                <s:selectItems value="#{businessCategoryList.resultList}" var="_category"
                               noSelectionLabel="#{messages.noSelectLabel}" label="#{_category.name}"/>
                <f:converter converterId="systemEntityConverter"/>
            </h:selectOneMenu>
        </s:decorate>



        <s:decorate styleClass="form-group " template="/layout/edit-big.xhtml">
            <ui:define name="label">#{messages.businessDefine_field_name}</ui:define>
            <ui:param name="for" value="name"/>
            <h:inputText id="name"
                         name="#{messages.businessDefine_field_name}"
                         required="true"
                         styleClass="form-control"
                         maxlength="50"
                         value="#{businessDefineHome.instance.name}">
                <r:validator event="blur"/>
            </h:inputText>

        </s:decorate>


        <s:decorate styleClass="form-group " template="/layout/edit-big.xhtml">
            <ui:define name="label">#{messages.businessDefine_field_operpage}</ui:define>
            <ui:param name="for" value="operPage"/>
            <h:inputText id="operPage"
                         name="#{messages.businessDefine_field_operpage}"
                         styleClass="form-control"
                         maxlength="200"
                         value="#{businessDefineHome.instance.startPage}">

            </h:inputText>

        </s:decorate>

        <s:decorate styleClass="form-group " template="/layout/edit-big.xhtml">
            <ui:define name="label">#{messages.businessDefing_field_rolePrefix}</ui:define>
            <ui:param name="for" value="rolePrefixInput"/>

            <h:inputText id="rolePrefixInput"
                         label=""
                         value="#{businessDefineHome.instance.rolePrefix}" styleClass="form-control"
                         maxlength="20"/>
        </s:decorate>

        <s:decorate styleClass="form-group " template="/layout/edit-big.xhtml">
            <ui:define name="label">#{messages.businessDefing_field_description}</ui:define>
            <ui:param name="for" value="descriptionInput"/>
            <h:inputTextarea value="#{businessDefineHome.instance.description}" id="descriptionInput"
                             styleClass="form-control"
                             label=""
                             name="#{messages.businessDefine_field_memo}">

            </h:inputTextarea>
        </s:decorate>

        <s:decorate styleClass="form-group " template="/layout/edit-big.xhtml">
            <ui:define name="label">#{messages.businessDefine_field_memo}</ui:define>
            <ui:param name="for" value="memo"/>
            <h:inputTextarea value="#{businessDefineHome.instance.memo}" id="memo"
                             styleClass="form-control"
                             label="#{messages.businessDefine_field_memo}"
                             name="#{messages.businessDefine_field_memo}">

            </h:inputTextarea>
        </s:decorate>

    </ui:decorate>


    <a:outputPanel layout="block" styleClass="columns">
    <a:outputPanel id="dataNav" layout="block" styleClass="column one-fourth codesearch-aside">
    <nav class="menu">
        <a:repeat value="#{businessCategoryList.resultList}" var="_category">
            <s:link styleClass="menu-item #{(businessDefineConfig.id eq _category.id) ? 'selected' : ''}"
                    propagation="none">
                #{_category.name}
                <h:outputText styleClass="counter" value="#{_category.businessDefineList.size}">
                    <f:convertNumber type="number" groupingUsed="true"/>
                </h:outputText>
                <f:param name="selectCategoryId" value="#{_category.id}"/>
            </s:link>
        </a:repeat>


    </nav>
    </a:outputPanel>

<h:form>

    <a:outputPanel id="dataResult" layout="block" styleClass="column three-fourths codesearch-results">

        <s:div styleClass="blankslate" rendered="#{empty businessDefineConfig.instance.businessDefineList}">
            <span class="mega-octicon octicon-search"></span>

            <h3>#{messages.EmptyResult}</h3>

            <p>  #{messages.YouCan}#{' '}
                <a:commandLink value="#{messages.create}"
                               execute="@this" immediate="true"
                               action="#{businessDefineConfig.createBusinessDefine}"
                               oncomplete="$('#editPanel').modal({backdrop: 'static'})"
                               render="editPanel_form">
                    <a:attachQueue requestDelay="0"/>

                </a:commandLink>


                #{' '} #{messages.Or}  #{messages.Try} #{' '}
                <s:link value="#{messages.reset}"/></p>
        </s:div>

        <a:outputPanel rendered="#{not empty businessDefineConfig.instance.businessDefineList}" layout="block" styleClass="notifications-list">
            <div class="boxed-group flush" style="margin-bottom: 0">

                <div class="boxed-group-action">
                    <a:commandLink styleClass="mark-all-as-read css-truncate tooltipped tooltipped-w"
                                   p:aria-label="#{messages.create}#{messages.businessDefine}"
                                   action="#{businessDefineConfig.createBusinessDefine}"
                                   render="editPanel_form" execute="@this" immediate="true"
                                   oncomplete="$('#editPanel').modal({backdrop: 'static'})">
                        <span class="octicon octicon-plus"/>
                        <a:attachQueue requestDelay="0"/>
                    </a:commandLink>
                </div>

                <h3>#{messages.businessDefine}
                    <h:outputText styleClass="counter" value="#{businessDefineConfig.instance.businessDefineList.size}">
                    <f:convertNumber type="number" groupingUsed="true"/>
                </h:outputText> </h3>


            </div>

            <ul class="boxed-group-inner notifications">
                <a:repeat value="#{businessDefineConfig.instance.businessDefineList}" var="_item">

                    <li class="list-group-item">
                        <span class="list-group-item-name css-truncate" style="max-width:600px">
                            <span class="type-icon octicon octicon-three-bars" aria-label="issues"></span>

                                <h:outputText value="#{_item.name}" styleClass="css-truncate-target #{_item.enable ? '' : 'delete-data'}" style="max-width: 600px">

                                </h:outputText>


                        </span>


                        <ul class="notification-actions">
                            <li class="mute">
                                <s:link styleClass="btn-link tooltipped tooltipped-w" style="color: #767676" p:aria-label="#{messages.BusinessDefingConfig}"
                                        view="/func/system/config/TaskSubscribeConfig.xhtml">
                                    <f:param name="businessDefineId" value="#{_item.id}"/>
                                    <span class="octicon octicon-puzzle"/>
                                </s:link>
                            </li>
                            <li class="mute">

                                <a:commandLink styleClass="btn-link tooltipped tooltipped-w"  style="color: #767676"
                                               oncomplete="$('#editPanel').modal({backdrop: 'static'})"
                                               render="editPanel_form" execute="@this" immediate="true"
                                               p:aria-label="#{messages.edit}">
                                    <span class="octicon octicon-pencil"/>
                                    <f:param name="businessDefineId" value="#{_item.id}"/>
                                    <a:attachQueue requestDelay="0"/>
                                </a:commandLink>

                            </li>

                        </ul>
                    </li>


                </a:repeat>



            </ul>

        </a:outputPanel>


    </a:outputPanel>

</h:form>
    </a:outputPanel>

        <s:button value="create" action="#{businessDefineConfig.addBusinessDefine}"/>



        <r:dataTable id="businessDefineTable" noDataLabel="#{messages.businessDefine_empty}" style="width:100%"
                        value="#{businessCategoryList.resultList}" var="_category">
            <f:facet name="header">
                <r:columnGroup>
                    <r:column colspan="7">
                        <h:outputText value="#{messages.businessCategory}"/>
                    </r:column>
                    <r:column breakRowBefore="true">
                        <h:outputText value="#{messages.businessDefine_field_id}"/>
                    </r:column>
                    <r:column>
                        <h:outputText value="#{messages.businessDefine_field_name}"/>

                    </r:column>

                    <r:column>
                        #{messages.businessDefine_field_wfname}
                    </r:column>

                    <r:column>
                        #{messages.businessDefine_field_operpage}
                    </r:column>

                    <r:column>
                        <h:outputText value="#{messages.action}"/>
                    </r:column>
                </r:columnGroup>
            </f:facet>
            <r:column colspan="7">
                <r:collapsibleSubTableToggler for="subTable"/>
                <h:outputText value="#{_category.name}"/>
            </r:column>
            <r:collapsibleSubTable value="#{_category.businessDefineList}" var="_bussinessDef" id="subTable"
                                      expandMode="client" expanded="#{false}">
                <r:column>
                    <h:outputText value="#{_bussinessDef.id}"/>
                </r:column>
                <r:column>
                    <a:outputPanel>

                        <h:outputText value="#{_bussinessDef.name}"/>
                        <r:tooltip followMouse="false" showDelay="1500" styleClass="tooltip-custom-body"
                                      layout="block" rendered="#{not empty _bussinessDef.memo}">
                            <span style="white-space: nowrap">#{_bussinessDef.memo}</span>
                        </r:tooltip>

                    </a:outputPanel>
                </r:column>
                <r:column>
                    <h:outputText value="#{_bussinessDef.wfName}"/>
                </r:column>

                <r:column>
                    <h:outputText value="#{_bussinessDef.startPage}"/>
                </r:column>

                <r:column>
                    <a:commandLink styleClass="no-decor" immediate="true" execute="@this"
                                   render="deleteButton" oncomplete="#{r:component('deleteConfirm')}.show()">
                        <h:graphicImage value="/img/icons/delete.png" alt="#{messages.delete}"/>
                        <a:param name="id" value="#{_bussinessDef.id}" assignTo="#{businessDefineHome.id}"/>
                        <a:attachQueue requestDelay="0"/>
                    </a:commandLink>

                    #{' '}
                    <s:link view="/func/system/config/TaskSubscribeConfig.xhtml">
                        <f:param name="businessDefineId" value="#{_bussinessDef.id}"/>
                        <s:graphicImage value="/img/icons/edit.png" title="#{messages.viewDetails}"/>
                    </s:link>
                    #{' '}
                    <s:link view="/func/system/config/ViewBusiness.xhtml">
                        <f:param name="ID" value="#{_bussinessDef.id}"/>
                        <f:param name="from" value="/func/system/config/BusinessMgr.xhtml"/>
                        <s:graphicImage value="/img/icons/view.png" title="#{messages.viewDetails}"/>
                    </s:link>
                </r:column>
                <f:facet name="footer">
                    <h:outputText value="#{_category.name}: #{_category.businessDefines.size}"/>
                </f:facet>
            </r:collapsibleSubTable>


        </r:dataTable>


        <s:decorate template="/layout/delete_confirm_dialog.xhtml">
            <ui:param name="panelId" value="deleteConfirm"/>
            <a:commandButton render="businessDefineTable" id="deleteButton" execute="@this" value="#{messages.remove}"
                             action="#{businessDefineHome.remove}"
                             oncomplete="#{r:component('deleteConfirm')}.hide()">
                <a:attachQueue requestDelay="0"/>
                <a:param name="processDefinitionId" value="#{businessDefineHome.id}"
                         assignTo="#{businessDefineHome.id}"/>
            </a:commandButton>
        </s:decorate>


</ui:composition>