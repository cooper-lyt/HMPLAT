<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.org/schema/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:r="http://richfaces.org"
                template="/layout/template.xhtml">

<ui:define name="taskChangePush">
    <r:push id="pushTask" address="pushTaskChange">
        <r:ajax event="dataavailable" render="ownerTasks,pooledTasks,taskOperLink,netOwnerTaskComeNotify,netPooledTaskComeNotify"/>
    </r:push>
</ui:define>

<ui:define name="body">

<r:toolbar height="30" itemSeparator="none">
    <r:toolbarGroup itemSeparator="none">
        <h:outputText value="#{messages.todoBussiness}"/>
    </r:toolbarGroup>
    <r:toolbarGroup location="right" itemSeparator="none">

        <r:commandButton image="/img/reset_btn.png" title="#{messages.reset}"
                         execute="@this" immediate="true"
                         action="#{pooledTaskSortFilter.reset}"
                         render="pooledTasks"/>
        <r:commandButton image="/img/refresh_btn.png" title="#{messages.refresh}" execute="@this"
                         immediate="true"
                         action="#{pooledTaskInstanceCacheList.refresh}"
                         render="pooledTasks"/>


    </r:toolbarGroup>
</r:toolbar>
<h:form>
    <r:extendedDataTable tableState="#{pooledTaskSortFilter.stateVar}" id="pooledTasks"
                            sortPriority="#{pooledTaskSortFilter.taskSortPriorities}"
                            value="#{pooledTaskInstanceCacheList.taskInstancePriorityList}" var="_task"
                            selectionMode="none" filterVar="_filterValue"
                            sortMode="#{pooledTaskSortFilter.sortMode}"
                            style="height:300px; width:100%;" clientRows="0" frozenColumns="5">

        <r:column width="30px">
            <f:facet name="header"></f:facet>
            <r:commandButton title="#{messages.acceptBusiness}" image="/img/receive.png"
                             immediate="true"
                             value="#{messages.acceptBusiness}" execute="@this"
                             action="#{pooledTask.assignToCurrentActor}">
                <f:param name="taskId" value="#{_task.id}"/>
                <r:attachQueue requestDelay="0"/>
            </r:commandButton>
        </r:column>


        <r:column width="90px" sortBy="#{_task.processInstance.key}"
                     filterValue="#{pooledTaskSortFilter.codeFilter}"
                     filterExpression="#{empty _filterValue or _task.processInstance.key eq _filterValue}">
            <f:facet name="header">
                <h:outputText value="#{messages.businessKey}"/>
            </f:facet>
            <r:outputPanel>

                #{_task.processInstance.key}
                <r:tooltip mode="ajax" followMouse="false" showDelay="1500" styleClass="tooltip"
                              layout="block">
                    <f:facet name="loading">
                        <h:graphicImage value="/img/smalBlueWait.gif"/>
                        &#160;
                        <h:outputText value="#{messages.wait_please}..."/>
                    </f:facet>
                    <span style="white-space: nowrap">#{messages.businessDefineId}:<strong>#{_task.variables.businessDefineId}</strong><br/>
                        #{messages.businessId}:<strong>#{_task.processInstance.id}</strong><br/>
                        #{messages.taskId}:<strong>#{_task.id}</strong><br/>
                        #{messages.processDefineDescription}: <strong>#{_task.processInstance.processDefinition.description}</strong>
                    </span>

                </r:tooltip>
            </r:outputPanel>
        </r:column>
        <r:column width="120px" sortBy="#{_task.variables.businessName}"
                     filterValue="#{pooledTaskSortFilter.nameFilter}"
                     filterExpression="#{empty _filterValue or fn:startsWith(_task.variables.businessName,_filterValue)}">
            <f:facet name="header">#{messages.businessName}</f:facet>
            <h:graphicImage style="float:right" alt="rf" value="/img/new_messages.png"
                            rendered="#{pooledTaskInstanceCacheList.isNewTask(_task.id)}"/>

            <h:outputText value="#{_task.}"/>
        </r:column>
        <r:column width="90px" sortBy="#{_task.name}" filterValue="#{pooledTaskSortFilter.taskNameFilter}"
                     filterExpression="#{empty _filterValue or fn:startsWith(_task.name, _filterValue)}">
            <f:facet name="header">#{messages.taskName}</f:facet>

            <r:outputPanel>
                <h:outputText value="#{_task.name}"/>
                <r:tooltip followMouse="false" showDelay="1000" styleClass="tooltip"
                              layout="block" rendered="#{not empty _task.description}">
                    <span style="white-space: nowrap">#{_task.description}</span>
                </r:tooltip>
            </r:outputPanel>
        </r:column>
        <r:column width="90px" sortBy="#{_task.variables.businessDescription}"
                     filterValue="#{pooledTaskSortFilter.descripitionFilter}"
                     filterExpression="#{empty _filterValue or fn:startsWith(_task.variables.businessDescription,_filterValue)}">
            <f:facet name="header">#{messages.businessDescription}</f:facet>
            #{_task.variables.businessDescription}
        </r:column>

        <r:column width="160px" sortBy="#{_task.processInstance.start}">
            <f:facet name="header">#{messages.businessCreatedTime}</f:facet>
            <h:outputText value="#{_task.processInstance.start}">
                <s:convertDateTime
                        pattern="#{messages.displayDateTimePattern}"/>
            </h:outputText>
        </r:column>
        <r:column width="160px" sortBy="#{_task.create}">
            <f:facet name="header">#{messages.taskCreatedTime}</f:facet>
            <h:outputText value="#{_task.create}">
                <s:convertDateTime
                        pattern="#{messages.displayDateTimePattern}"/>
            </h:outputText>
        </r:column>

        <r:column width="80px" sortBy="#{_task.priority}">
            <f:facet name="header">#{messages.taskPriority}</f:facet>
            <h:outputText value="#{_task.priority}">
                <f:converter converterId="priorityConverter"/>
            </h:outputText>

        </r:column>

        <r:column width="70px" sortBy="#{_task.processInstance.version}">
            <f:facet name="header">#{messages.version}</f:facet>
            #{_task.processInstance.processDefinition.version}
        </r:column>

        <f:facet name="footer">#{messages.todobusinessCount} #{pooledTaskInstanceCacheList.taskInstancePriorityList.size}</f:facet>
    </r:extendedDataTable>
</h:form>

<r:toolbar height="30" itemSeparator="none">
    <r:toolbarGroup itemSeparator="none">
        <h:outputText value="#{messages.myBussiness}"/>
    </r:toolbarGroup>
    <r:toolbarGroup location="right" itemSeparator="none">
        <r:commandButton image="/img/reset_btn.png" title="#{messages.reset}"
                         execute="@this" immediate="true"
                         action="#{taskSortFilter.reset}"
                         render="ownerTasks"/>
        <r:commandButton image="/img/refresh_btn.png" title="#{messages.refresh}" execute="@this"
                         immediate="true" action="#{ownerTaskInstanceCacheList.refresh}"
                         render="ownerTasks"/>
    </r:toolbarGroup>
</r:toolbar>

<h:form>
    <r:extendedDataTable id="ownerTasks"
                            tableState="#{taskSortFilter.stateVar}" sortPriority="#{taskSortFilter.taskSortPriorities}"
                            value="#{ownerTaskInstanceCacheList.taskInstanceCreateList}" var="_task"
                            selectionMode="none" filterVar="_filterValue" sortMode="#{taskSortFilter.sortMode}"
                            style="height:260px; width:100%;" clientRows="0" frozenColumns="5">

        <r:column width="50px">
            <f:facet name="header"></f:facet>

            <r:commandButton title="#{messages.unAcceptBusiness}" image="/img/forward.png"
                             action="#{pooledTask.unassign}" immediate="true"
                             execute="@this"
                             onclick="if (#{empty _task.pooledActors}) {alert('#{messages.cantUnassignTask}');return false;}">
                <f:param name="taskId" value="#{_task.id}"/>
                <r:attachQueue requestDelay="0"/>
            </r:commandButton>
            #{' '}
            <s:link image="img/handle.png" action="#{taskPrepare.beginTask}" taskInstance="#{_task}">
                <s:graphicImage value="/img/handle.png" title="#{messages.operateBusiness}"/>
            </s:link>

        </r:column>


        <r:column width="90px" sortBy="#{_task.processInstance.key}"
                     filterValue="#{taskSortFilter.codeFilter}"
                     filterExpression="#{empty _filterValue or _task.processInstance.key eq _filterValue}">
            <f:facet name="header">
                #{messages.businessKey}
            </f:facet>
            <r:outputPanel>

                <h:outputText value="#{_task.processInstance.key}"/>

                <r:tooltip mode="ajax" followMouse="false" showDelay="1500" styleClass="tooltip"
                              layout="block">
                    <f:facet name="loading">
                        <h:graphicImage value="/img/smalBlueWait.gif"/>
                        &#160;
                        <h:outputText value="#{messages.wait_please}..."/>
                    </f:facet>
                    <span style="white-space: nowrap">#{messages.businessDefineId}:<strong>#{_task.variables.businessDefineId}</strong><br/>
                        #{messages.businessId}:<strong>#{_task.processInstance.id}</strong><br/>
                        #{messages.taskId}:<strong>#{_task.id}</strong><br/>
                        #{messages.processDefineDescription}: <strong>#{_task.processInstance.processDefinition.description}</strong>
                    </span>

                </r:tooltip>
            </r:outputPanel>
        </r:column>
        <r:column width="120px" sortBy="#{_task.variables.businessName}"
                     filterValue="#{taskSortFilter.nameFilter}"
                     filterExpression="#{empty _filterValue or fn:startsWith(_task.variables.businessName,_filterValue)}">
            <f:facet name="header">#{messages.businessName}</f:facet>
            <h:graphicImage style="float:right" alt="rf" value="/img/new_messages.png"
                            rendered="#{ownerTaskInstanceCacheList.isNewTask(_task.id)}"/>
            <h:outputText value="#{_task.variables.businessName}"/>
        </r:column>
        <r:column width="90px" sortBy="#{_task.name}" filterValue="#{taskSortFilter.taskNameFilter}"
                     filterExpression="#{empty _filterValue or fn:startsWith(_task.name, _filterValue)}">
            <f:facet name="header">#{messages.taskName}</f:facet>

            <r:outputPanel>
                <h:outputText value="#{_task.name}"/>
                <r:tooltip followMouse="false" showDelay="1000" styleClass="tooltip"
                              layout="block">
                    <span style="white-space: nowrap">#{_task.description}</span>
                </r:tooltip>
            </r:outputPanel>
        </r:column>
        <r:column width="90px" sortBy="#{_task.variables.businessDescription}"
                     filterValue="#{taskSortFilter.descripitionFilter}"
                     filterExpression="#{empty _filterValue or fn:startsWith(_task.variables.businessDescription,_filterValue)}">
            <f:facet name="header">#{messages.businessDescription}</f:facet>
            #{_task.variables.businessDescription}
        </r:column>

        <r:column width="160px" sortBy="#{_task.processInstance.start}">
            <f:facet name="header">#{messages.businessCreatedTime}</f:facet>
            <h:outputText value="#{_task.processInstance.start}">
                <s:convertDateTime
                        pattern="#{messages.displayDateTimePattern}"/>
            </h:outputText>
        </r:column>
        <r:column width="160px" sortBy="#{_task.create}">
            <f:facet name="header">#{messages.taskCreatedTime}</f:facet>
            <h:outputText value="#{_task.create}">
                <s:convertDateTime
                        pattern="#{messages.displayDateTimePattern}"/>
            </h:outputText>
        </r:column>

        <r:column width="80px" sortBy="#{_task.priority}">
            <f:facet name="header">#{messages.taskPriority}</f:facet>

            <h:outputText value="#{_task.priority}">
                <f:converter converterId="priorityConverter"/>
            </h:outputText>
        </r:column>

        <r:column width="70px" sortBy="#{_task.processInstance.version}">
            <f:facet name="header">#{messages.version}</f:facet>
            #{_task.processInstance.processDefinition.version}
        </r:column>
        <f:facet
                name="footer">#{messages.mybusinessCount} #{ownerTaskInstanceCacheList.taskInstanceCreateList.size}</f:facet>

    </r:extendedDataTable>
</h:form>

</ui:define>
</ui:composition>