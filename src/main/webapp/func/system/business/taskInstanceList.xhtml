<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:s="http://jboss.org/schema/seam/taglib"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:a="http://richfaces.org/a4j" xmlns:r="http://richfaces.org/rich" >

    <f:subview >

        <a:outputPanel id="taskListPanel">
    <a:outputPanel layout="block" styleClass="blankslate" rendered="#{empty taskList.resultList}">
        <h3>#{emptyTitle}</h3>
        <p>#{emptyDescription} <a:commandLink immediate="true" execute="@this" render="taskListPanel"
                                              value="#{messages.refresh}" action="#{taskList.refresh}">
            <a:attachQueue requestDelay="0"/>
        </a:commandLink></p>
    </a:outputPanel>

    <a:outputPanel layout="block" styleClass="setup-form" rendered="#{not empty taskList.resultList}">
        <div class="file-navigation in-mid-page" style="margin-top: 0">
            <a:commandLink styleClass="btn btn-sm btn-sm-icon btn-primary left compare-button " action="#{taskList.refresh}" render="taskListPanel">
                <span class="octicon octicon-sync"/>
                <a:attachQueue requestDelay="0"/>
            </a:commandLink>
            <h:selectOneMenu styleClass="selectpicker mini-select" p:data-width="150px" p:data-header="#{messages.FilterBusinessCategory}"
                             value="#{taskList.selectCategoryId}">
                <s:selectItems value="#{taskList.filterCategorys}" var="_category"
                               label="#{_category.category.name}" itemValue="#{_category.category.id}" noSelectionLabel="#{messages.AllBusinessCategory}"/>
                <a:ajax event="valueChange" execute="@this" listener="#{taskList.reset}" render="myBizDefineFilter,taskList">
                    <a:attachQueue requestDelay="0"/>
                </a:ajax>
            </h:selectOneMenu>

            <a:outputPanel id="myBizDefineFilter">
                <a:outputPanel rendered="#{not empty taskList.selectCategory}">
                    <span class="i-separator">/</span>
                    <h:selectOneMenu p:data-header="#{messages.FilterBusinessDefine}" p:data-width="220px"  styleClass="selectpicker mini-select"  value="#{taskList.selectDefineId}">
                        <s:selectItems value="#{taskList.selectCategory.defineList}" var="_define"
                                       label="#{_define.name}" itemValue="#{_define.id}" noSelectionLabel="#{messages.AllBusinessDefine}"/>
                        <a:ajax event="valueChange" listener="#{taskList.reset}" execute="@this" render="taskList">
                            <a:attachQueue requestDelay="0"/>
                        </a:ajax>
                    </h:selectOneMenu>
                </a:outputPanel>
            </a:outputPanel>
        </div>



        <h:outputStylesheet>
            .boxed-group-inner li:hover{
                background-color: #f5f9fc;
            }
        </h:outputStylesheet>

        <a:outputPanel layout="block" styleClass="notifications-list" id="taskList">

            <div class="boxed-group flush">
                <h3><span style="font-weight: bold;" >#{taskListTitle}</span>  <span class="counter"> #{taskList.resultList.size} </span> </h3>
                <ul class="boxed-group-inner notifications">
                    <a:repeat value="#{taskList.resultList}" var="_task">
                        <li class="list-group-item read">

                            <div class="repo-list-stats">
                                <a:commandLink action="#{pooledTask.unassign}" immediate="true" render="taskListPanel"
                                               execute="@this" rendered="#{_task.myTask and (not _task.myOnly)}" styleClass="repo-list-stat-item tooltipped tooltipped-s">
                                    <span class="octicon octicon-repo-push"/>
                                    #{messages.unAcceptTask}
                                    <f:param name="taskId" value="#{_task.taskInstance.id}"/>
                                    <a:attachQueue requestDelay="0"/>
                                </a:commandLink>

                                <s:link image="/img/icons/handle.png" rendered="#{_task.myTask}"
                                        styleClass="repo-list-stat-item tooltipped tooltipped-s"
                                        action="#{taskPrepare.beginTask}" taskInstance="#{_task.taskInstance}">
                                    <span class="octicon octicon-repo"/>
                                    #{messages.operTask}
                                </s:link>
                                <a:commandLink rendered="#{not _task.myTask}" immediate="true" execute="@this"
                                               action="#{pooledTask.assignToCurrentActor}" render="taskListPanel"
                                               styleClass="repo-list-stat-item tooltipped tooltipped-s">
                                    <span class="octicon octicon-repo-pull"/>
                                    #{messages.acceptTask}
                                    <f:param name="taskId" value="#{_task.taskInstance.id}"/>
                                    <a:attachQueue requestDelay="0"/>
                                </a:commandLink>


                                <a:commandLink rendered="#{not _task.myTask}" styleClass="repo-list-stat-item tooltipped tooltipped-s">
                                    <span class="octicon octicon-repo-clone"/>
                                    #{messages.acceptAndOperTask}
                                </a:commandLink>


                            </div>
                            <h3 class="repo-list-name">
                                  <span class="type-icon octicon #{(_task.myTask) ? ( _task.myOnly ? 'octicon-broadcast' : 'octicon-person') : 'octicon-organization'}"/>
                                #{_task.businessDefine.businessCategory.name} / #{_task.businessDefine.name} / #{_task.taskInstance.name}
                            </h3>

                            <p class="repo-list-description">
                                #{_task.taskDescription.description}
                            </p>

                            <p class="repo-list-meta">
                                <h:outputText value=" #{_task.taskDescription.businessKey}" style="font-weight: bold; color: #666;">

                                </h:outputText>


                                #{messages.businessCreatedTimeBy}:
                                <h:outputText value="#{_task.taskDescription.createTime}">
                                    <s:convertDateTime pattern="#{messages.displayDateTimePattern}"/>
                                </h:outputText>
                                #{' '}
                                #{messages.taskCreatedTimeBy}:
                                <h:outputText value="#{_task.taskInstance.create}">
                                    <s:convertDateTime pattern="#{messages.displayDateTimePattern}"/>
                                </h:outputText>
                            </p>

                        </li>
                    </a:repeat>
                </ul>
            </div>

        </a:outputPanel>
 </a:outputPanel>
        </a:outputPanel>
    </f:subview>
</ui:composition>