<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:s="http://jboss.org/schema/seam/taglib"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:a="http://richfaces.org/a4j" xmlns:r="http://richfaces.org/rich" >

    <f:subview >

        <a:outputPanel id="taskListPanel">
    <a:outputPanel layout="block" styleClass="blankslate" rendered="#{empty taskList.resultList}">
        <h3>#{emptyTitle}</h3>
        <p>#{emptyDescription} <a:commandLink immediate="true" execute="@this" render="taskListPanel"
                                              value="#{messages.refresh}" action="#{taskList.refresh}">
            <a:attachQueue requestDelay="0"/>
        </a:commandLink></p>
    </a:outputPanel>

    <a:outputPanel layout="block" styleClass="setup-form" rendered="#{not empty taskList.resultList}">
        <div class="file-navigation in-mid-page" style="margin-top: 0">
            <a:commandLink styleClass="btn btn-sm btn-sm-icon btn-primary left compare-button "
                           immediate="true" execute="@this" status="processWaiting"
                           action="#{taskList.refresh}" render="taskListPanel">
                <span class="octicon octicon-sync"/>
                <a:attachQueue requestDelay="0"/>
            </a:commandLink>
            <h:selectOneMenu styleClass="selectpicker mini-select" p:data-width="150px" p:data-header="#{messages.FilterBusinessCategory}"
                             value="#{taskList.selectCategoryId}">
                <s:selectItems value="#{taskList.filterCategorys}" var="_category"
                               label="#{_category.category.name}" itemValue="#{_category.category.id}" noSelectionLabel="#{messages.AllBusinessCategory}"/>
                <a:ajax event="valueChange" execute="@this" listener="#{taskList.reset}" render="myBizDefineFilter,taskList">
                    <a:attachQueue requestDelay="0"/>
                </a:ajax>
            </h:selectOneMenu>

            <a:outputPanel id="myBizDefineFilter">
                <a:outputPanel rendered="#{not empty taskList.selectCategory}">
                    <span class="i-separator">/</span>
                    <h:selectOneMenu p:data-header="#{messages.FilterBusinessDefine}" p:data-width="220px"
                                     styleClass="selectpicker mini-select"  value="#{taskList.selectDefineId}">
                        <s:selectItems value="#{taskList.selectCategory.defineList}" var="_define"
                                       label="#{_define.name}" itemValue="#{_define.id}" noSelectionLabel="#{messages.AllBusinessDefine}"/>
                        <a:ajax event="valueChange" listener="#{taskList.reset}" execute="@this" render="taskList">
                            <a:attachQueue requestDelay="0"/>
                        </a:ajax>
                    </h:selectOneMenu>
                </a:outputPanel>
            </a:outputPanel>
        </div>



        <h:outputStylesheet>
            .boxed-group-inner li:hover{
                background-color: #f5f9fc;
            }


        </h:outputStylesheet>

        <a:outputPanel layout="block" styleClass="notifications-list" id="taskList">

            <div class="boxed-group flush">
                <h3><span style="font-weight: bold;" >#{taskListTitle}</span>  <span class="counter"> #{taskList.resultList.size} </span> </h3>
                <ul class="boxed-group-inner notifications">
                    <a:repeat value="#{taskList.resultList}" var="_task">
                        <li class="list-group-item read">

                            <div class="repo-list-stats">

                            <div class="btn-group" role="group" aria-label="...">


                                <a:commandLink action="#{pooledTask.unassign}" immediate="true" render="taskListPanel"
                                               execute="@this" rendered="#{_task.myTask and (not _task.myOnly)}"
                                               p:aria-label="#{messages.unAcceptTask}" status="processWaiting"
                                               styleClass="btn btn-sm btn-warning tooltipped tooltipped-s">


                                    <f:param name="taskId" value="#{_task.taskInstance.id}"/>
                                    <a:attachQueue requestDelay="0"/>
                                    <span class="btn-icon glyphicon glyphicon-export"></span>

                                </a:commandLink>



                                <a:commandLink rendered="#{not _task.myTask}" immediate="true" execute="@this"
                                               action="#{pooledTask.assignToCurrentActor}" render="taskListPanel"
                                               p:aria-label="#{messages.acceptTask}" status="processWaiting"
                                               styleClass="btn btn-sm btn-primary tooltipped tooltipped-s">


                                    <f:param name="taskId" value="#{_task.taskInstance.id}"/>
                                    <a:attachQueue requestDelay="0"/>

                                    <span class="btn-icon glyphicon glyphicon-import"></span>
                                </a:commandLink>


                                <s:link  styleClass="btn btn-sm btn-default" action="#{taskPrepare.operTask}"
                                         taskInstance="#{_task.taskInstance}"
                                        style=" #{_task.myOnly ? 'border-bottom-left-radius: 3px; border-top-left-radius: 3px;' : ''}">
                                    #{_task.myTask ? messages.operTask : messages.acceptAndOperTask}
                                </s:link>

                                <ui:remove>

                                <div class="btn-group btn-group-sm task-action-down-menu">
                                    <ui:decorate template="/layout/dropdown-actions.xhtml">

                                        <ui:define name="caption">

                                        </ui:define>
                                        <ui:param name="menuTitle" value="#{messages.TaskOper}"/>


                                        <a:commandLink action="#{pooledTask.unassign}" immediate="true" render="taskListPanel"
                                                       execute="@this" rendered="#{_task.myTask and (not _task.myOnly)}"
                                                       styleClass="select-menu-item">


                                            <f:param name="taskId" value="#{_task.taskInstance.id}"/>
                                            <a:attachQueue requestDelay="0"/>
                                            <span class="select-menu-item-icon octicon octicon-check"></span>
                                            <span class="select-menu-item-text"> #{messages.unAcceptTask}</span>
                                        </a:commandLink>

                                        <a:commandLink rendered="#{not _task.myTask}" styleClass="select-menu-item">
                                            <span class="select-menu-item-icon octicon octicon-check"></span>
                                            <span class="select-menu-item-text">#{messages.acceptAndOperTask}</span>

                                        </a:commandLink>
                                        <s:link rendered="#{_task.myTask}"
                                                styleClass="select-menu-item"
                                                action="#{taskPrepare.beginTask}" taskInstance="#{_task.taskInstance}">
                                            <span class="select-menu-item-icon octicon octicon-check"></span>
                                            <span class="select-menu-item-text">#{messages.operTask}</span>

                                        </s:link>

                                        <a:commandLink rendered="#{not _task.myTask}" immediate="true" execute="@this"
                                                       action="#{pooledTask.assignToCurrentActor}" render="taskListPanel"
                                                       styleClass="select-menu-item">


                                            <f:param name="taskId" value="#{_task.taskInstance.id}"/>
                                            <span class="select-menu-item-icon octicon octicon-check"></span>
                                            <span class="select-menu-item-text">#{messages.acceptTask}</span>
                                        </a:commandLink>

                                    </ui:decorate>
                                </div>
                                </ui:remove>

                            </div>
                            </div>
                            <h3 class="repo-list-name">
                                  <span class="type-icon octicon #{(_task.myTask) ? ( _task.myOnly ? 'octicon-broadcast' : 'octicon-person') : 'octicon-organization'}"
                                          style="color:#{(_task.myTask) ? '#5cb85c' : '#337ab7'}"/>
                                #{_task.businessDefine.businessCategory.name} / #{_task.businessDefine.name} / #{_task.taskInstance.name}
                            </h3>

                            <p class="repo-list-description">
                                #{_task.taskDescription.description}
                            </p>

                            <p class="repo-list-meta">
                                <h:outputText value=" #{_task.taskDescription.businessKey}" style="font-weight: bold; color: #666;">

                                </h:outputText>


                                #{messages.businessCreatedTimeBy}:
                                <h:outputText value="#{_task.taskDescription.createTime}">
                                    <s:convertDateTime pattern="#{messages.displayDateTimePattern}"/>
                                </h:outputText>
                                #{' '}
                                #{messages.taskCreatedTimeBy}:
                                <h:outputText value="#{_task.taskInstance.create}">
                                    <s:convertDateTime pattern="#{messages.displayDateTimePattern}"/>
                                </h:outputText>
                            </p>

                        </li>
                    </a:repeat>
                </ul>
            </div>

        </a:outputPanel>
 </a:outputPanel>
        </a:outputPanel>
    </f:subview>
</ui:composition>